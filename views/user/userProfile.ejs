<!-- header here only seprated -->
<!-- linking costum css category dropdown -->
<link rel="stylesheet" href="/css/userCategoryDropdown.css" type="text/css">
<!-- linking end here -->

<!-- top-area Start -->
<div class="top-area">
    <div class="header-area">
        <!-- Start Navigation -->
        <nav class="navbar navbar-default bootsnav  navbar-sticky navbar-scrollspy" data-minus-value-desktop="70"
            data-minus-value-mobile="55" data-speed="1000">

            <!-- Start Top Search -->
            <div class="top-search">
                <div class="container">
                    <div class="input-group">
                        <span class="input-group-addon"><i class="fa fa-search"></i></span>
                        <input type="text" class="form-control" placeholder="Search">
                        <span class="input-group-addon close-search"><i class="fa fa-times"></i></span>
                    </div>
                </div>
            </div>
            <!-- End Top Search -->

            <div class="container">
                <!-- Start Atribute Navigation -->
                <div class="attr-nav">
                    <ul>
                        <li class="search">
                            <a href="#"><span class="lnr lnr-magnifier"></span></a>
                        </li><!--/.search-->
                        <li class="nav-setting dropdown">
                            <a href="#"><i class="bi bi-person dropdown-toggle" data-bs-toggle="dropdown"
                                    aria-expanded="false"></i></a>
                            <ul class="dropdown-menu">
                                <% if (users) { %>
                                    <li><a class="dropdown-item" href="/userProfile">Profile</a></li>
                                    <li><a class="dropdown-item" href="/wishlist">Wishlist</a></li>
                                    <li><a class="dropdown-item" href="/userLogOut">Logout</a></li>
                                    <%} else { %>
                                        <li><a class="dropdown-item" href="/login">Login</a></li>
                                        <% } %>
                            </ul>
                        </li><!--/.search-->

                        <li class="dropdown <% if(page==" cart"){ %>active <% } %>">
                                <a href="/userCart" class="dropdown-toggle" data-toggle="dropdown">
                                    <i class="bi bi-cart2"></i>
                                    <% if (users) { %>
                                        <span class="badge badge-bg-1" id="cart-count">
                                            <%= users.cart.items.length %>
                                        </span>
                                        <% } %>
                                </a>
                        </li>
                    </ul>
                </div><!--/.attr-nav-->
                <!-- End Atribute Navigation -->

                <!-- Start Header Navigation -->
                <div class="navbar-header d-flex">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-menu">
                        <i class="fa fa-bars"></i>
                    </button>
                    <button class="toggle-button p-2" data-bs-toggle="offcanvas"
                        data-bs-target="#offcanvasWithBothOptions" aria-controls="offcanvasWithBothOptions"><i
                            class="fa-solid fa-bars text-dark"></i></button>
                    <a class="navbar-brand" style="margin-left: 1.5em;padding-top: 1.1em;" href="/">URBANCART</a>

                </div><!--/.navbar-header-->
                <!-- End Header Navigation -->

                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse menu-ui-design" id="navbar-menu">
                    <ul class="nav navbar-nav navbar-center" data-in="fadeInDown" data-out="fadeOutUp">
                        <li class=" nav-item <% if(page==" home"){ %>active <% } %>"><a href="/">Home</a></li>
                        <li class="nav-item <% if(page==" furnitures"){ %>active <% } %>"><a
                                    href="/products">Furnitures</a></li>
                        <li class="nav-item <% if(page==" orders"){ %>active <% } %>"><a href="">Orders</a></li>

                        <li class="nav-item">
                            <div class="dropdown text-dark">
                                <a class="dropbtn">Category</a>
                                <div class="dropdown-content">
                                    <a href="/products">
                                        All Products
                                    </a>
                                    <% showCategory.forEach((el)=>{ %>
                                        <a class="dropdown-item" href="/products?category=<%= el._id %>">
                                            <%=el.category %>
                                        </a>
                                        <% }) %>
                                </div>
                            </div>
                        </li>
                    </ul><!--/.nav -->

                    <!-- style for li to center -->
                    <style>
                        .nav li {
                            width: 100;
                            height: 100;
                            display: flex;
                            align-items: center;
                        }

                        input {
                            border-radius: 1em;
                        }
                    </style>


                </div><!-- /.navbar-collapse -->
            </div><!--/.container-->
        </nav><!--/nav-->
        <!-- End Navigation -->
    </div><!--/.header-area-->
    <div class="clearfix"></div>

</div><!-- /.top-area-->
<!-- top-area End -->
<!-- header end -->

<main class="container" style="margin-top: 5em;">
    <!-- sidebar start -->
    <div class="offcanvas offcanvas-start" data-bs-scroll="true" tabindex="-1" id="offcanvasWithBothOptions"
        aria-labelledby="offcanvasWithBothOptionsLabel">
        <div class="offcanvas-header ms-auto">
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <ul class="list-group list-group-flush costum-border">
                <li class="list-group-item"><a class="text-decoration-none text-dark" href=""><b> Account
                            details</b></a>
                </li>
                <li class="list-group-item"><a class="text-decoration-none text-dark" href="/userAddress">Address</a>
                </li>
                <li class="list-group-item"><a class="text-decoration-none text-dark" href="">Oders</a></li>
                <li class="list-group-item"><a class="text-decoration-none text-dark" href="">Whishlist</a></li>
                <li class="list-group-item "><a class="text-decoration-none text-danger" href="">Logout</a></li>
            </ul>
        </div>
    </div>
    <!-- sidebar end -->

    <!-- main content -->

    <section class="row justify-content-center">
        <div class="col-12 col-sm-10 col-md-6 d-flex flex-column align-items-center">
            <h1 class="pt-5 pb-5 text-center">Your Account</h1>
            <div class="user-details col-12 col-md-12 d-flex align-items-center flex-column">
                <div class="col-3 d-flex flex-column align-items-center mt-2">
                    <i class="bi bi-person-circle" style="font-size: 4em;"></i>
                </div>
                <% if(users){ %>
                    <div class="col-9" style="margin-top: 2em;">
                        <form id="user-details">
                            <div class="form-group">
                                <label for="fullName">Full Name</label>
                                <input type="text" name="fullName" value="<%= users.fullName %>"
                                    class="form-control mt-2" id="fullName" aria-describedby="emailHelp"
                                    placeholder="Enter email">
                            </div>
                            <div class="form-group mt-4">
                                <label for="emailAddress">Email Address</label>
                                <input type="email" name="emailAddress" value="<%= users.email %>"
                                    class="form-control mt-2" id="emailAddress" placeholder="Password">
                            </div>
                            <div class="form-group mt-4">
                                <label for="phone">Phone</label>
                                <input type="tel" name="phone" value="<%= users.phone %>" class="form-control mt-2"
                                    id="phone" placeholder="Phone">
                            </div>
                            <button type="submit" onclick="submitForm()" class="btn btn-warning mt-3">Save
                                changes</button>
                        </form>
                        <!-- <button type="button"  class="btn btn-warning mt-3"
                            onclick="submitForm()">Save
                            changes</button> -->
                    </div>
                    <% } %>
            </div>
        </div>
    </section>

    <section class="row justify-content-center pb-4" style="margin-top: 7em;">
        <div class="col-10 col-md-4">
            <form id="passwordChange">
                <h5 class="mb-5 text-center">change password</h5>
                <div class="form-group">
                    <label for="currentPassword">Current Password</label>
                    <div id="incorrectCurrentPasswordMsg"></div>
                    <input type="password" name="currentPassword" class="form-control mt-2" id="currentPassword"
                        aria-describedby="passwordHelp" placeholder="Current password">
                </div>
                <div class="form-group mt-4">
                    <label for="newPassword">New Password</label>
                    <div id="incorrectNewPasswordMsg"></div>
                    <input type="password" name="newPassword" class="form-control mt-2" id="newPassword"
                        placeholder="Password">
                </div>
                <div class="form-group mt-4">
                    <label for="confirmPassword">Confirm Pasword</label>
                    <div id="incorrectPasswordMsg"></div>
                    <!-- <p class="text-danger" style="font-size: small;">confirm password didn't match!</p> -->
                    <input type="password" name="confirmPassword" class="form-control mt-2" id="confirmPassword"
                        placeholder="Confirm Pasword">
                </div>
                <button type="submit" class="btn btn-warning mt-3">Change Password</button>
            </form>
            <!-- <button type="submit" class="btn btn-warning mt-3">Save</button> -->
        </div>
    </section>
</main>


<script>
    function submitForm() {
        Swal.fire(
            'Changes Saved!',
            'click it!',
            'success'
        )
        setTimeout(() => {
            $('#signupForm').submit()
        }, 1500)
    }

    function changePassword() {
        Swal.fire(
            'Password changed!',
            'click it!',
            'success'
        )
        setTimeout(() => {
            $('#passwordChange').submit()
        }, 1500)
    }

    /* edit user details */
    const formEl = document.querySelector('#user-details');
    formEl.addEventListener('submit', event => {
        const editForm = document.getElementById("user-details");
        var formData = new FormData(editForm);
        let dataToSend = Object.fromEntries(formData);
        console.log($('#user-details').serialize());
        $.ajax({
            url: '/editDetails',
            method: 'post',
            dataType: 'json',
            encode: true,
            data: $('#user-details').serialize(),
        }).done((data) => {
            console.log(data);
        })
        event.preventDefault()
    })







    /* password chanaging */
    const changePasswordForm = document.querySelector('#passwordChange');
    changePasswordForm.addEventListener('submit', event => {
        if ($('#currentPassword').val() == '' || $('#newPassword').val() == '' || $('#confirmPassword').val() == '') {
            if ($('#currentPassword').val() == '') {
                $('#incorrectCurrentPasswordMsg').html(`<p class="text-danger" style="font-size: small;">required!</p>`)
            } else {
                $('#incorrectCurrentPasswordMsg').html('')
            }
            if ($('#newPassword').val() == '') {
                $('#incorrectNewPasswordMsg').html(`<p class="text-danger" style="font-size: small;">required!</p>`)
            } else {
                $('#incorrectNewPasswordMsg').html('')
            }
            if($('#confirmPassword').val() == '') {
                $('#incorrectPasswordMsg').html(`<p class="text-danger" style="font-size: small;">required!</p>`)
            }else{
                 $('#incorrectPasswordMsg').html('')
            }
        } else {
            if ($('#newPassword').val() == $('#confirmPassword').val()) {
                const editForm = document.getElementById("user-details");
                const formData = new FormData(editForm);
                let dataToSend = Object.fromEntries(formData);
                console.log($('#passwordChange').serialize());
                Swal.fire({
                    title: 'Do you want to save the changes?',

                    showCancelButton: true,
                    confirmButtonText: 'Save',

                }).then((result) => {
                    /* Read more about isConfirmed, isDenied below */
                    if (result.isConfirmed) {
                        $.ajax({
                            url: '/changeUserPassword',
                            method: 'post',
                            dataType: 'json',
                            encode: true,
                            data: $('#passwordChange').serialize(),
                        }).done((data) => {
                            if (data.success) {
                                /* changePassword() */
                                console.log('password changed..')
                                Swal.fire('Saved!', '', 'success')
                            }else{
                                console.log('password not matching...')
                                  Swal.fire('Incorrect Password!', '', 'error')
                            }
                        })
                    }
                })
                console.log('password matching')
                $('#incorrectPasswordMsg').html('');
            } else {
                console.log("confirm password didn't match")
                $('#incorrectPasswordMsg').html(`<p class="text-danger" style="font-size: small;">confirm password didn't match!</p>`)
            }
            $('#incorrectNewPasswordMsg').html('')
            $('#incorrectCurrentPasswordMsg').html('')
        }
        event.preventDefault()
    })
</script>